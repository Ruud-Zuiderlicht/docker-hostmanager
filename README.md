# [WIP] Docker HostManager

[![Build Status](https://travis-ci.org/guillemcanal/docker-hostmanager.svg?branch=master)](https://travis-ci.org/guillemcanal/docker-hostmanager)
[![codecov](https://codecov.io/gh/guillemcanal/docker-hostmanager/branch/master/graph/badge.svg)](https://codecov.io/gh/guillemcanal/docker-hostmanager)
[![quality](https://sonarcloud.io/api/project_badges/measure?project=docker-hostmanager&metric=sqale_rating)](https://sonarcloud.io/dashboard?id=docker-hostmanager)
[![smells](https://sonarcloud.io/api/project_badges/measure?project=docker-hostmanager&metric=code_smells)](https://sonarcloud.io/project/issues?id=docker-hostmanager&resolved=false&types=CODE_SMELL)

Access your Docker containers using **domain names** either with **HTTP** or **HTTPS**.

The Docker HostManager update your `hosts` file and generate TLS certificates  
when a container gets created with just a couple of labels.

## Run

### Linux

```shell
# Run the docker manager
docker run --detach -t --name docker-hostmanager \
--restart always \
--volume docker-hostmanager-data:/data:rw \
--volume /etc/hosts:/host/etc/hosts:rw \
--volume /var/run/docker.sock:/var/run/docker.sock:ro \
gcanal/docker-hostmanager:latest
```

### Mac

```shell
# Make your /etc/hosts/ writable
sudo chmod 777 /etc/hosts

# Run the docker manager
docker run --detach -t --name docker-hostmanager \
--restart always \
--volume docker-hostmanager-data:/data:rw \
--volume /private/etc/hosts:/host/etc/hosts:rw \
--volume /var/run/docker.sock:/var/run/docker.sock:ro \
gcanal/docker-hostmanager:latest
```

### Windows

No tested yet, to be documented.

## Install the root certificate

In order to access your domains using HTTPS, you will need to add the Root Certificate generated by DockerHostManager  
in your browsers and in your trusted root certification authorities.

```shell
# Copy the certificate from a docker volume anywhere on your host machine
docker cp docker-hostmanager:/data/root-ca.crt .
```

**Note**: if you are using **Firefox**, you will need to add your certificate using the following method :

1. Open `Preferences`
2. On the top right corner, search: `certificates`
3. Click on `View Certificates...`
4. Click on the `Authorities` tab
5. Click on `Import...`
6. Add your `root-ca.crt`
7. Tick the box `Trust this CA to identify websites.`
8. Click on `Ok`

### Linux (Ubuntu, Debian)

```shell
sudo cp root-ca.crt /usr/local/share/ca-certificates/
sudo update-ca-certificates --fresh
```

### Mac

```shell
sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/root-ca.crt
```

### Windows 

```shell
certutil -addstore -f "ROOT" root-ca.crt
```

## Usage example

```shell
docker run --rm -t \
--label 'traefik.enable=true' \
--label 'traefik.port=80' \
--label 'traefik.backend=demo' \
--label 'traefik.frontend.rule=Host: nginx.docker' \
nginx:alpine
```

Head to <http://nginx.docker> or <https://nginx.docker>
